---
difficulty: Hard
---

import Player from "@site/src/components/Player";
import Image from "@site/src/components/Image";
import EntrySearch from "@site/src/components/EntrySearch";
import ActionButton from "@site/src/components/ActionButtons";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Граница опции
:::danger[Before Starting]
Это руководство для опытных пользователей. Желательно хорошо понимать, как работают [Взаимодействия](../../01-interactions/index.mdx) и [Границы взаимодействия](./).
:::
:::info[Story]
Сценарий этого гайда: официант спрашивает, за каким столиком игрок хотел бы сесть.
:::

В этом уроке вы узнаете, как создать вариант выбора с применённой к нему границей взаимодействия. Это позволит менять позицию игрока при пролистывании вариантов.

## Создание опции
:::info[Entity Extension]
Для этого примера мы свяжем опцию с `On Entity Interact Event` из [Entity Extension](../../04-entity-extension/index.mdx).
:::

### Создание диалога с опциями

Сначала создадим диалог с вариантами, который будет показываться при взаимодействии игрока с официантом:

1. Щёлкните правой кнопкой по `On Entity Interact Event` и выберите `+ Link with ...`
2. Найдите `Option` и добавьте его в последовательность

<EntrySearch entryName="option" />

## Настройка опции
Теперь, когда опция добавлена, её нужно настроить. Выберите элемент `Option` и откройте инспектор.

Задайте текст диалога `Welcome, at which table would you like to sit?` и варианты:
- **Spruce Table**
- **Birch Table**
- **Dark Oak Table**
- **Go Back**

Подробнее о настройке вариантов можно узнать в [руководстве по опциям](../../01-interactions/01-options.mdx).

## Добавление границы взаимодействия
Чтобы добавить границу, щёлкните правой кнопкой по элементу `On Entity Interact Event` и выберите `Link with ...`, затем найдите `Lock Interaction Bound` и добавьте его в последовательность.
<EntrySearch entryName='lock_interaction_bound' />

## Настройка границы взаимодействия
Выберите `Lock Interaction Bound` и откройте инспектор.

### Добавление переменной Case
Активируйте параметр Target Position в инспекторе и нажмите <ActionButton button='dynamic-variable'/>. Найдите `Add Case Variable` и добавьте его на страницу facts.

<EntrySearch entryName="case_variable" />

### Настройка Case Variable
Выберите `Case Variable` и откройте инспектор.

:::info[Case Variable]
Переменная Case хранит разные позиции в зависимости от переданного числа:

- Система **начинается с 1** (не с 0)
- Case 0 = позиция по умолчанию (если совпадение не найдено)
- Если подходящий case не найден, используется позиция по умолчанию
:::

Для нашего примера с рестораном:
1. Задайте **позицию по умолчанию** с помощью значка <ActionButton button='capture'/> (используется при отсутствии совпадения)
2. Нажмите `+` в поле cases, чтобы добавить четыре позиции обзора:
   - **Case 1**: Spruce Table location
   - **Case 2**: Birch Table location
   - **Case 3**: Dark Oak Table location
   - **Case 4**: Go Back location (original position)
3. Захватите каждую позицию с помощью значка <ActionButton button='capture'/>
4. В итоге `Case Variable` будет выглядеть так:
<Image img={require("../../../assets/interactions/option-bound-case-variables.png")} width="400" />

### Добавление переменной контекста взаимодействия
Сейчас при пролистывании вариантов ничего не происходит. Нужно добавить `Interaction Context Variable` в `Case Variable` внутри `Lock Interaction Bound`.

Для этого нажмите <ActionButton button='dynamic-variable'/> в поле `Selection` у элемента `Case Variable` и найдите `Interaction Context Variable`.

<EntrySearch entryName="interaction_context_variable" />

### Настройка переменной контекста

Эта переменная автоматически предоставляет индекс выбранного варианта:

1. Выберите элемент `Interaction Context Variable`
2. В инспекторе нажмите `Select a Entry`
3. Выберите созданный ранее элемент `Option`
4. `Interaction Context Variable` должна выглядеть так:
<Image img={require("../../../assets/interactions/option-bound-target-position.png")} width="400" />

:::info[About the Case Count]
На изображении показано `Cases (0)`, потому что я настроил случаи глобально на странице facts, а не локально в этом элементе.\
Переменные можно настраивать двумя способами:
* глобально (на странице facts для повторного использования)
* локально (внутри конкретной записи).

Функциональность одинаковая — система использует соответствующую позицию в зависимости от выбранного индекса.
:::
## Результат
Теперь ваши страницы должны выглядеть так:
<Tabs Group defaultValue="sequence" groupId="page" queryString>
   <TabItem value="sequence" label="Sequence Page">
      <Image img={require("../../../assets/interactions/option-bound-sequence.png")} />
   </TabItem>
   <TabItem value="static" label="Static Page">
      <Image img={require("../../../assets/interactions/option-bound-static.png")} />
   </TabItem>
</Tabs>
Когда игроки взаимодействуют с официантом, они видят меню выбора. При прокрутке разных столиков камера автоматически поворачивается к каждому из них, создавая эффект погружения.

<Player url={require("../../../assets/interactions/option-bound-result.webm").default} />

:::warning[Confirmation Key]
Во время написания этих документов был найден баг с клавишей подтверждения. Если у вас назначено `SWAP_HANDS` (F), то находясь внутри границы взаимодействия диалог не продолжится. Нажмите SPACE, чтобы продолжить!
:::

## Как это работает

Механизм Option Bound работает через следующие ключевые компоненты:

1. **Lock Interaction Bound** — управляет положением и обзором игрока
2. **Case Variable** — хранит разные позиции для каждой опции
3. **Interaction Context Variable** — предоставляет текущий индекс варианта
4. **Option Entry** — отображает диалог

Когда игрок пролистывает варианты, переменная Interaction Context обновляется текущим индексом, выбирает соответствующую позицию из Case Variable, и Lock Interaction Bound применяет эту позицию к игроку.

Это создаёт плавный эффект, когда взгляд игрока меняется в зависимости от наведённого варианта, позволяя ему "смотреть" на выбор в игровом мире.