---
difficulty: Hard
---

import Player from "@site/src/components/Player";
import Image from "@site/src/components/Image";
import EntrySearch from "@site/src/components/EntrySearch";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Границы взаимодействия
:::info[Прежде чем начать]
Это руководство предполагает установленный [Basic Extension](../../02-getting-started/01-installation.mdx#basic-extension).
:::
:::danger[Внимание]
Материал предназначен для опытных пользователей. Рекомендуем хорошо понимать, как работают [Взаимодействия](../../01-interactions/index.mdx).
:::

Перед началом немного теории о границах взаимодействия и их использовании в историях.

## Что такое границы взаимодействия?
Границы взаимодействия — это условия, ограничивающие действие или область, в которой может происходить взаимодействие. Они позволяют контролировать, когда и как его можно прервать. Типичный пример — отмена диалога, если игрок отходит от NPC.

### Два режима работы
Границы могут работать в двух режимах:

#### Режим прерывания
Если игрок выходит за пределы границы (например, покидает заданную зону), взаимодействие сразу отменяется. Подходит для необязательных разговоров, когда можно свободно уйти.

#### Блокирующий режим
Игрок не может нарушить границу вовсе. Нельзя, например, уйти от важного диалога. Это гарантирует, что игрок полностью увидит ключевой момент сюжета.

| Режим | Поведение | Применение |
|------|----------|----------|
| Прерывание | Взаимодействие отменяется при выходе за границу | Дополнительные диалоги, фоновые взаимодействия |
| Блокировка | Игрок не может выйти за границу | Важные сюжетные моменты, инструкции |

### Как определяется режим
Режим зависит от сравнения **приоритета** взаимодействия с **приоритетом** границы:

- Если у взаимодействия **выше приоритет** — работает **блокирующий режим**
- Если у взаимодействия **такой же или ниже приоритет** — включается **режим прерывания**

:::tip
Записи наследуют приоритет от страницы, на которой находятся. Настраивайте приоритеты в свойствах страницы.
:::

## Как использовать границы взаимодействия
Теперь посмотрим на примеры применения границ. Мы подготовили три ситуации:

<Tabs defaultValue="interruption" groupId="boundType" queryString>
    <TabItem value="interruption" label="Режим прерывания">
    :::info[Пример]
    Здесь показано, как сделать прерываемую границу, если игрок отходит от цветка.
    :::
    :::warning[Начальная настройка]
    Пример основан на руководстве [Взаимодействия](../../01-interactions/index.mdx) и требует хотя бы записи `On Interact With Block` в редакторе.
    :::

    #### Добавляем границу
    Щёлкните правой кнопкой на `On Interact With Block` и выберите `Link with ...`, затем найдите `Player Radius Interaction Bound` и добавьте его в последовательность.
    <EntrySearch entryName='player_radius_interaction_bound' />

    #### Настраиваем границу
    После добавления откройте инспектор `Player Radius Interaction Bound`.
    Доступно две настройки:
    - **Radius** — радиус, на котором срабатывает отмена взаимодействия
    - **zoom** — следует ли приближать камеру, когда игрок рядом, и отдалять при отходе

    В результате последовательность будет выглядеть примерно так:
    <Image img={require("../../../assets/interactions/interaction-bound-player-radius-interupting.png")} />

    #### Результат
    Взаимодействие будет выглядеть так:
    <Player url={require("../../../assets/interactions/interaction-bound-interupting-result.webm").default} />
    </TabItem>
    <TabItem value="blocking" label="Блокирующий режим">
    :::info[Пример]
    Здесь показано, как сделать блокирующую границу, если игрок пытается уйти от цветка.
    :::
    :::warning[Начальная настройка]
    Пример основан на руководстве [Взаимодействия](../../01-interactions/index.mdx) и требует записи `On Interact With Block` в редакторе.
    :::

    #### Добавляем границу
    Аналогично предыдущему примеру, добавьте `Player Radius Interaction Bound`.
    <EntrySearch entryName='player_radius_interaction_bound' />

    #### Делаем границу блокирующей
    Сейчас граница прерываемая. Чтобы сделать её блокирующей, установите приоритет записи `Spoken` выше, чем у `Player Radius Interaction Bound`.
    Для этого:
    1. создайте новую страницу последовательности, например `Blocking Bounds`;
    2. перетащите `Player Radius Interaction Bound` на новую страницу;
    3. откройте свойства страницы со `Spoken`;
    4. выберите `Change Priority` и установите число больше, чем у страницы с границей (например, 1 при нулевом приоритете у `Blocking Bounds`).
    5. Теперь последовательность выглядит так:
    <Image img={require("../../../assets/interactions/interaction-bound-player-radius-blocking.png")} />

    #### Результат
    Взаимодействие будет выглядеть так:
    <Player url={require("../../../assets/interactions/interaction-bound-blocking-result.webm").default} />
    </TabItem>
    <TabItem value="interuption-player" label="Режим прерывания (Entity Extension)">
    :::info[Пример]
    Здесь будет пример прерываемой границы, если игрок отходит от NPC.
    :::
    :::warning[Entity Extension]
    Для примера необходимо заранее создать NPC с помощью [Entity Extension](../../04-entity-extension/index.mdx)
    :::

    :::danger[СКОРО]
    Это руководство ещё не готово. Загляните позже.
    :::
    </TabItem>
</Tabs>
