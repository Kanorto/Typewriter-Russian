---
difficulty: Hard
---

import Player from "@site/src/components/Player";
import Image from "@site/src/components/Image";
import EntrySearch from "@site/src/components/EntrySearch";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Границы взаимодействия
:::info[Before starting]
В этом руководстве предполагается, что у вас уже установлено [Basic Extension](../../../02-getting-started/01-installation.mdx#basic-extension).
:::
:::danger[Before Starting]
Это руководство предназначено для опытных пользователей. Рекомендуется хорошо понимать, как работают [Взаимодействия](../../01-interactions/index.mdx)!
:::

Перед началом следует разобраться в теории границ взаимодействия, чтобы правильно применять их в своих историях.

## Что такое границы взаимодействия?

Границы взаимодействия — это условия, ограничивающие взаимодействие определённым действием или пространством. Они позволяют контролировать, когда и как может происходить или прерываться взаимодействие. Распространённый пример — отмена диалога, если игрок отходит от NPC.

### Два режима границ

Границы взаимодействия работают в двух режимах:

#### Режим прерывания
В режиме прерывания, если игрок нарушает условие (например, выходит за пределы зоны), взаимодействие сразу отменяется. Полезно для неформальных диалогов, когда игроку можно свободно уйти.

#### Блокирующий режим
В блокирующем режиме игрок не может нарушить условие — например, уйти от важного диалога. Это гарантирует, что он полностью воспримет ключевой момент сюжета.


| Режим | Поведение | Сценарий |
|------|-----------|----------|
| Прерывание | Взаимодействие отменяется при нарушении границы | Необязательные диалоги, фоновые взаимодействия |
| Блокировка | Игрок не может нарушить границу | Важные сюжетные моменты, важные инструкции |


### Как определяется режим

Режим определяется сравнением **приоритета** взаимодействия и **приоритета** границы:

- Если взаимодействие имеет **более высокий приоритет**, чем граница → **Блокирующий режим**
- Если приоритет взаимодействия **равен или ниже**, чем у границы → **Режим прерывания**

:::tip
Записи наследуют приоритет от страницы, к которой принадлежат. Задавать приоритеты страниц можно в панели свойств страницы.
:::

## Как использовать границы взаимодействия
Теперь, когда теория изучена, посмотрим, как применять границы взаимодействия в своих историях.\
В рамках этого руководства мы подготовили три разных примера, демонстрирующих использование границ в разных ситуациях:

<Tabs defaultValue="interruption" groupId="boundType" queryString>
    <TabItem value="interruption" label="Interruption Mode">
    :::info[Guide]
    Здесь мы покажем, как сделать прерываемую границу взаимодействия, когда игрок отходит от цветка.
    :::
    :::warning[Initial Setup]
    Мы будем основываться на [руководстве по взаимодействиям](../../01-interactions/index.mdx), поэтому в редакторе должен быть хотя бы элемент
    `On Interact With Block`.
    :::

    #### Добавление границы взаимодействия
    Чтобы добавить границу, нажмите правой кнопкой на элементе `On Interact With Block` и выберите `Link with ...`, затем найдите `Player Radius Interaction Bound` и добавьте его в последовательность.
    <EntrySearch entryName='player_radius_interaction_bound' />

    #### Настройка границы
    После добавления границы её нужно настроить.\
    Выберите элемент `Player Radius Interaction Bound` и откройте инспектор

    Доступно две настройки
    - **Radius**: радиус границы, на котором взаимодействие будет отменяться.
    - **zoom**: приближать ли камеру игрока, когда он рядом, и отдалять при уходе.

    Теперь последовательность должна выглядеть примерно так:
    <Image img={require("../../../assets/interactions/interaction-bound-player-radius-interupting.png")} />

    #### Результат
    Теперь взаимодействие будет выглядеть так:
    <Player url={require("../../../assets/interactions/interaction-bound-interupting-result.webm").default} />
    </TabItem>
    <TabItem value="blocking" label="Blocking Mode">
    :::info[Guide]
    Здесь мы покажем пример блокирующей границы взаимодействия, когда игрок отходит от цветка.
    :::
    :::warning[Initial Setup]
    Мы будем основываться на [руководстве по взаимодействиям](../../01-interactions/index.mdx) и требуем наличие элемента
    `On Interact With Block` в редакторе.
    :::

    #### Добавление границы взаимодействия
    Чтобы добавить границу, нажмите правой кнопкой на элементе `On Interact With Block` и выберите `Link with ...`, затем найдите `Player Radius Interaction Bound` и добавьте его в последовательность.
    <EntrySearch entryName='player_radius_interaction_bound' />

    #### Делаем границу блокирующей
    Сейчас у вас создана прерываемая граница. Чтобы сделать её блокирующей, установите элементу `Spoken` приоритет выше, чем у `Player Radius Interaction Bound`.\
    Для этого
    1. создайте новую страницу последовательности, назовите её, например, `Blocking Bounds`.
    2. Выберите `Player Radius Interaction Bound` и удерживайте несколько секунд.
    3. Перетащите его на новую страницу.
    4. Щёлкните правой кнопкой на странице со `Spoken`.
    5. **Выберите `Change Priority` и задайте значение выше, чем у `Player Radius Interaction Bound`.** \
    Например, если у страницы `Blocking Bounds` приоритет 0, странице со `Spoken` задайте 1.
    6. Теперь последовательность должна выглядеть так:
    <Image img={require("../../../assets/interactions/interaction-bound-player-radius-blocking.png")} />

    #### Результат
    Теперь взаимодействие будет выглядеть так:
    <Player url={require("../../../assets/interactions/interaction-bound-blocking-result.webm").default} />
    </TabItem>
    <TabItem value="interuption-player" label="Interruption Mode (Entity Extension)">
    :::info[Guide]
    Здесь будет пример прерываемой границы взаимодействия, когда игрок отходит от NPC.
    :::
    :::warning[Entity Extension]
    Для выполнения примера требуется заранее создать NPC с помощью [Entity Extension](../../04-entity-extension/index.mdx)
    :::

    :::danger[SOON]
    Это руководство ещё не готово. Загляните позже.
    :::
    </TabItem>
</Tabs>